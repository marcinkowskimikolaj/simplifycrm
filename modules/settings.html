<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Ustawienia CRM - Simplify CRM</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="../styles/base.css">
  <link rel="stylesheet" href="../styles/settings.css">
  <link rel="stylesheet" href="../styles/custom-fields.css">
</head>
<body>

<header class="app-header">
  <div class="app-header-inner">
    <div class="app-header-left">
      <div class="app-logo" id="appLogo">Simplify CRM</div>
      <div class="app-logo-subtitle">Ustawienia CRM</div>
    </div>
    <div class="app-header-right">
      <span class="user-email" id="userEmail">≈Åadowanie...</span>
      <button id="logoutBtn" class="logout-btn">Wyloguj</button>
    </div>
  </div>
</header>

<main class="main-container">
  <div class="settings-layout">
    <aside class="settings-nav">
      <button class="settings-nav-item active" data-section="custom-fields">
        <span class="settings-nav-emoji">üß©</span>
        <span class="settings-nav-text">
          <span class="settings-nav-title">Pola w≈Çasne</span>
          <span class="settings-nav-subtitle">Kontakty i firmy</span>
        </span>
      </button>

      <button class="settings-nav-item" data-section="pipeline">
        <span class="settings-nav-emoji">üß≠</span>
        <span class="settings-nav-text">
          <span class="settings-nav-title">Pipeline</span>
          <span class="settings-nav-subtitle">Etapy sprzeda≈ºy</span>
        </span>
        <span class="badge-soon">Wkr√≥tce</span>
      </button>

      <button class="settings-nav-item" data-section="ai">
        <span class="settings-nav-emoji">‚ú®</span>
        <span class="settings-nav-text">
          <span class="settings-nav-title">Ustawienia AI</span>
          <span class="settings-nav-subtitle">Modele i klucze</span>
        </span>
        <span class="badge-soon">Wkr√≥tce</span>
      </button>
    </aside>

    <section class="settings-content">

      <!-- CUSTOM FIELDS -->
      <section class="settings-section active" id="section-custom-fields">
        <div class="settings-section-header">
          <div>
            <h1 class="settings-title">Pola w≈Çasne</h1>
            <p class="settings-subtitle">Zdefiniuj w≈Çasne pola dla kontakt√≥w i firm. Pola poka≈ºƒÖ siƒô w formularzach oraz w widoku szczeg√≥≈Ç√≥w.</p>
          </div>
          <button class="btn btn-primary" id="addCustomFieldBtn">+ Dodaj pole</button>
        </div>

        <div class="settings-scope-tabs">
          <button class="scope-tab active" data-scope="company">Firmy</button>
          <button class="scope-tab" data-scope="contact">Kontakty</button>
          <button class="scope-tab" data-scope="both">Obie</button>
        </div>

        <div class="settings-card">
          <div class="table-wrap">
            <table class="settings-table" id="customFieldsTable">
              <thead>
                <tr>
                  <th>Nazwa</th>
                  <th>Klucz</th>
                  <th>Typ</th>
                  <th>Wymagane</th>
                  <th>Aktywne</th>
                  <th>Kolejno≈õƒá</th>
                  <th>Akcje</th>
                </tr>
              </thead>
              <tbody id="customFieldsTbody">
                <tr><td colspan="7" class="muted">≈Åadowanie...</td></tr>
              </tbody>
            </table>
          </div>

          <div class="settings-hint muted">
            üí° Arkusze wymagane w Google Sheets: <b>CustomFields</b> oraz <b>CustomFieldValues</b>.
          </div>
        </div>
      </section>

      <!-- PIPELINE -->
      <section class="settings-section" id="section-pipeline">
        <div class="settings-section-header">
          <div>
            <h1 class="settings-title">Pipeline</h1>
            <p class="settings-subtitle">ZarzƒÖdzanie etapami sprzeda≈ºy (nazwa, kolejno≈õƒá, prawdopodobie≈Ñstwo, kolor).</p>
          </div>
          <span class="badge-soon big">Wkr√≥tce</span>
        </div>

        <div class="settings-card">
          <h3 class="card-title">Co tu bƒôdzie</h3>
          <ul class="card-list">
            <li>Dodawanie / edycja etap√≥w</li>
            <li>Domy≈õlne etapy dla nowych lead√≥w</li>
            <li>Regu≈Çy automatyzacji (np. po zmianie etapu)</li>
          </ul>
          <div class="muted">Na razie przygotowana jest struktura strony oraz nawigacja ‚Äî kodowanie logiki pipeline zrobimy w kolejnym kroku.</div>
        </div>
      </section>

      <!-- AI SETTINGS -->
      <section class="settings-section" id="section-ai">
        <div class="settings-section-header">
          <div>
            <h1 class="settings-title">Ustawienia AI</h1>
            <p class="settings-subtitle">PodglƒÖd aktualnych ustawie≈Ñ oraz przysz≈Çe miejsce do zarzƒÖdzania providerami i promptami.</p>
          </div>
          <span class="badge-soon big">Wkr√≥tce</span>
        </div>

        <div class="settings-card">
          <h3 class="card-title">Aktualny stan (z localStorage)</h3>
          <div class="ai-status-grid">
            <div class="ai-status-item">
              <div class="ai-status-label">Provider</div>
              <div class="ai-status-value" id="aiProviderValue">‚Äî</div>
            </div>
            <div class="ai-status-item">
              <div class="ai-status-label">Klucz API</div>
              <div class="ai-status-value" id="aiKeyValue">‚Äî</div>
            </div>
            <div class="ai-status-item">
              <div class="ai-status-label">Zgoda (consent)</div>
              <div class="ai-status-value" id="aiConsentValue">‚Äî</div>
            </div>
          </div>

          <div class="muted" style="margin-top: 0.75rem;">
            Docelowo przeniesiemy tu pe≈Çne zarzƒÖdzanie: wyb√≥r modelu, test po≈ÇƒÖczenia, prompt globalny i limity.
          </div>
        </div>
      </section>

    </section>
  </div>
</main>

<!-- MODAL: Add/Edit Custom Field -->
<div class="modal" id="customFieldModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="customFieldModalTitle">Dodaj pole</h2>
      <button class="close-btn" id="closeCustomFieldModalBtn">&times;</button>
    </div>

    <form id="customFieldForm">
      <div class="form-group">
        <label for="cfLabel">Nazwa pola *</label>
        <input id="cfLabel" type="text" required placeholder="np. ≈πr√≥d≈Ço leadu">
      </div>

      <div class="form-group">
        <label for="cfKey">Klucz (ID) *</label>
        <input id="cfKey" type="text" required placeholder="np. lead_source">
        <div class="form-hint">U≈ºywany do zapisu warto≈õci (musi byƒá unikalny).</div>
      </div>

      <div class="form-group">
        <label for="cfEntityType">Dotyczy</label>
        <select id="cfEntityType">
          <option value="company">Firma</option>
          <option value="contact">Kontakt</option>
          <option value="both">Firma + Kontakt</option>
        </select>
      </div>

      <div class="form-group">
        <label for="cfType">Typ pola</label>
        <select id="cfType">
          <option value="text">Tekst (1 linia)</option>
          <option value="textarea">Tekst (wielolinijkowy)</option>
          <option value="number">Liczba</option>
          <option value="date">Data</option>
          <option value="select">Lista wyboru</option>
          <option value="checkbox">Checkbox (Tak/Nie)</option>
          <option value="email">Email</option>
          <option value="url">URL</option>
        </select>
      </div>

      <div class="form-group" id="cfOptionsGroup" style="display:none;">
        <label for="cfOptions">Opcje (1 linia = 1 opcja)</label>
        <textarea id="cfOptions" placeholder="np.
Polecenie
Wyszukiwarka
Reklama"></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="cfRequired">Wymagane</label>
          <select id="cfRequired">
            <option value="false">Nie</option>
            <option value="true">Tak</option>
          </select>
        </div>
        <div class="form-group">
          <label for="cfEnabled">Aktywne</label>
          <select id="cfEnabled">
            <option value="true">Tak</option>
            <option value="false">Nie</option>
          </select>
        </div>
        <div class="form-group">
          <label for="cfOrder">Kolejno≈õƒá</label>
          <input id="cfOrder" type="number" value="0" min="0">
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" id="cancelCustomFieldBtn">Anuluj</button>
        <button type="submit" class="btn btn-primary">Zapisz</button>
      </div>
    </form>
  </div>
</div>

<script type="module" src="./settings.js"></script>
</body>
</html>
